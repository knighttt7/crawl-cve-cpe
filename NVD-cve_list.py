import os
import requests
from lxml import etree
from time import sleep
headers = {
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0'
    }


def cve_list_crawler(url,headers,year,month):
    page_text=requests.get(url=url,headers=headers)
    page_text.encoding='utf-8'
    # print(url,headers)
    tree=etree.HTML(page_text.text)
    # print(tree)
    span_list=tree.xpath('//*[@id="body-section"]/div[2]/div/span')
    # print(span_list)

    for span in span_list:
        cve_link="https://nvd.nist.gov"+span.xpath('./a/@href')[0]
        cve_num=span.xpath('./a/text()')[0]
        # print(cve_link,cve_num)

        with open(year+'/'+month+'.txt', 'a', encoding='utf-8') as f:
            f.write(cve_link + ','+cve_num+'\n')
        # break



if __name__=="__main__":
    f = open('E:\\activities\\file_and_code\\py\\work\\cve\\month_link.txt', 'r', encoding='utf-8')
    urls = f.readlines()
    for url in urls:
        url = url.rstrip('\n')
        #按年份创建文件夹，按月份保存到txt文件
        split_list = url.split('/')
        year_name = split_list[-2]
        month_name = split_list[-1]
        #创建年份文件夹
        if not os.path.exists(year_name):
            os.mkdir(year_name)

        cve_list_crawler(url, headers,year_name,month_name)
        print(year_name,month_name)
        sleep(5)
    f.close()
