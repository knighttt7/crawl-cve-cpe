import os
import requests
from lxml import etree

headers = {
      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36 Edg/87.0.664.75'
    }

url='https://nvd.nist.gov/vuln/full-listing'


def nvd_crawler(url,headers):
    page_text=requests.get(url=url,headers=headers)
    page_text.encoding='utf-8'
    print(url, headers)
    tree=etree.HTML(page_text.text)
    span_list=tree.xpath('//*[@id="body-section"]/div[2]/span')

    for span in span_list:
        li_list=span.xpath('./ul/li')
        for li in li_list:
            month_link='https://nvd.nist.gov'+li.xpath('./a/@href')[0]
            with open('./month_link.txt','a',encoding='utf-8') as f:
                f.write(month_link+'\n')
            print(month_link)

if __name__=="__main__":
    nvd_crawler(url,headers)